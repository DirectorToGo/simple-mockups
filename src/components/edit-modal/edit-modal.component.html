@if (editableDocument(); as doc) {
  <div (click)="onCancel()" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300 ease-in-out"
       [class.opacity-100]="isShowing()"
       [class.opacity-0]="!isShowing()">
    <div (click)="onModalClick($event)" class="bg-white rounded-lg shadow-xl w-full max-w-2xl transform transition-all duration-300 ease-in-out"
         [class.opacity-100]="isShowing()" [class.scale-100]="isShowing()"
         [class.opacity-0]="!isShowing()" [class.scale-95]="!isShowing()">
      <div class="p-6 border-b border-gray-200 flex justify-between items-center">
        <h2 class="text-2xl font-semibold text-gray-800">{{ readonly() ? 'View Document' : 'Edit Document' }}: {{ doc.name }}</h2>
        <button (click)="onCancel()" class="p-1 rounded-full text-gray-500 hover:bg-gray-100 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
      </div>
      <div class="p-6 max-h-[60vh] overflow-y-auto">
        <form #editForm="ngForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">

          <!-- Column 1 -->
          <div class="space-y-4">
            <div>
              <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
              <input type="text" id="name" name="name" [(ngModel)]="doc.name" [disabled]="readonly()" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 bg-white text-gray-900">
            </div>
            <div>
              <label for="term" class="block text-sm font-medium text-gray-700 mb-1">Term</label>
              <input type="text" id="term" name="term" [(ngModel)]="doc.term" [disabled]="readonly()" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 bg-white text-gray-900">
            </div>
            <div>
              <label for="termCategory" class="block text-sm font-medium text-gray-700 mb-1">Term Category</label>
              <select id="termCategory" name="termCategory" [(ngModel)]="doc.termCategory" [disabled]="readonly()" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 bg-white text-gray-900">
                @for(option of termCategoryOptions; track option) {
                  <option [value]="option">{{ option }}</option>
                }
              </select>
            </div>
            <div>
              <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
              <select id="status" name="status" [(ngModel)]="doc.status" [disabled]="readonly()" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 bg-white text-gray-900">
                @for(option of statusOptions; track option) {
                  <option [value]="option">{{ option }}</option>
                }
              </select>
            </div>
             <div class="flex items-center pt-1">
              <label class="flex items-center cursor-pointer">
                <input type="checkbox" id="published" name="published" [(ngModel)]="doc.published" [disabled]="readonly()" class="sr-only">
                <div class="w-5 h-5 mr-3 flex items-center justify-center border-2 rounded" [class]="doc.published ? 'bg-pink-600 border-pink-600' : 'bg-white border-gray-400'">
                  @if(doc.published) {
                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                  }
                </div>
                <span class="block text-sm text-gray-900">Published</span>
              </label>
            </div>
          </div>

          <!-- Column 2 -->
          <div class="space-y-4">
            <div>
              <label for="docType" class="block text-sm font-medium text-gray-700 mb-1">Document Type</label>
              <select id="docType" name="docType" [(ngModel)]="doc.type" [disabled]="readonly()" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 bg-white text-gray-900">
                @for(option of docTypeOptions; track option) {
                  <option [value]="option">{{ option }}</option>
                }
              </select>
            </div>
            <div>
              <label for="subject" class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
              <input type="text" id="subject" name="subject" [(ngModel)]="doc.subject" [disabled]="readonly()" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 bg-white text-gray-900">
            </div>
            <div>
              <label for="organization" class="block text-sm font-medium text-gray-700 mb-1">Organization</label>
              <input type="text" id="organization" name="organization" [(ngModel)]="doc.organization" [disabled]="readonly()" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 bg-white text-gray-900">
            </div>
            <div>
              <label for="instructor" class="block text-sm font-medium text-gray-700 mb-1">Instructor</label>
              <input type="text" id="instructor" name="instructor" [(ngModel)]="doc.instructor" [disabled]="readonly()" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 bg-white text-gray-900">
            </div>
          </div>
        </form>
          <div class="mt-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Syllabus components</h3>
            <p class="text-xs text-gray-500 mb-3">Admins can edit all. Instructors can edit only if they are the instructor of this document. Students can view only.</p>
            @if (doc.syllabusDetails; as details) {
              <div class="space-y-4">
                @for (comp of getOrderedComponents(doc); track comp.name) {
                  <div class="border border-gray-200 rounded-md p-3 bg-white">
                    <div class="flex items-center justify-between mb-2">
                      <div class="text-sm font-medium text-gray-800">{{ comp.name }}</div>
                      <span class="text-xs px-2 py-0.5 rounded-full bg-gray-100 text-gray-700">{{ comp.type }}</span>
                    </div>
                    <textarea [name]="'comp-'+comp.name" rows="3" [(ngModel)]="comp.content" [disabled]="!canEditComponents(doc) || readonly()" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 bg-white text-gray-900 placeholder:text-gray-500" placeholder="Enter content..."></textarea>
                  </div>
                }
              </div>
            }
          </div>

      </div>
      <div class="p-6 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3 rounded-b-lg">
        <button (click)="onCancel()" type="button" class="px-4 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors">
          Cancel
        </button>
        @if (!readonly()) { <button (click)="onSave()" type="button" class="px-4 py-2 bg-pink-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500 transition-colors">
          Save Changes
        </button> }
      </div>
    </div>
  </div>
}